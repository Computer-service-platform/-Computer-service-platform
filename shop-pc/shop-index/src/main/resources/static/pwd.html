<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>修改密码</title>
<link href="css/style.css" type="text/css" rel="stylesheet" />
<script src="js/jquery-1.7.min.js" type="text/javascript"></script>
<script src="js/common.js" type="text/javascript"></script>

</head>
<body class="index">
<div class="top_ad"><div class="w1200"><a href="#" id="close"></a></div></div>
<div id="yc_login">
<div class="top">
	<div class="w1200">
		<div class="left">您好，欢迎光临易易城！
			<div v-if="onlogin"><em>[{{user.nickName}}]&nbsp;&nbsp;&nbsp;</em><a href="javascript:void(0)" @click="out()">[注销]</a>
			</div>
			<div v-if="outlogin">
				<a href="login.html">[登录]</a> <a href="reg.html">[注册]</a>
			</div>
		</div>
        <div class="right"><a href="member.html">我的会员中心</a>|<a href="#">服务中心</a>|<a href="#">在线客服</a>|<a href="shopcar.html">购物车<b>{{goodsCount}}</b>件</a></div>
        <div class="clear"></div>
    </div>
</div>

<div class="head">
	<div class="w1200">
    	<div class="logo"><a href="index.html"></a></div>
        <div class="s_r">
        	<dl>
            	<dt><a href="shopcar.html">购物车<span>{{goodsCount}}</span></a></dt>
                <dd>客服电话：<b>400-0139-038</b></dd>
            </dl>
        </div>
        <div class="clear"></div>
    </div>
</div>

<div class="menu">
	<div class="w1200">
    	
    </div>
</div>


<div class="w1200">
	<div class="position"><a href="index.html">首页</a> > <a href="member.html">会员中心</a> > <a href="member.html">个人资料</a></div>
    
    <div class="m_d">
    	<div class="left">
        	<dl><dt>账户管理</dt>
            <dd>
            	<a href="member.html">个人资料</a>
                <a href="javascript:void(0)" class="on">修改密码</a>
                <a href="buyRecord.html">我的订单</a>
            </dd>
            </dl>
     
        </div>
        <div class="right">
        	<dl class="dl01">
            	<dt><img src="images/ico04.jpg"/></dt>
                <dd>
					<table width="725" border="0" cellpadding="0" cellspacing="0">
                      <tr>
                        <td width="416" class="td01">尊敬的，<font>{{user.nickName}}</font> 您好！</td>
                        <td width="44">余额：</td>
                        <td width="122"><span>{{user.restMoney}}元</span></td>
                        <td width="56" align="right">积分：</td>
                        <td width="87"><span>{{user.moneyPoint}}</span></td>
                      </tr>
                      <tr>
                        <td>还没有上传头像？ 点击<br/><input id="pics" type="file" name="photo" style="width: 70px"/><a class="save" href="javascript:void(0)" @click="goHead()">保存</a></td>
                      </tr>
                    </table>
                    <img :src="user.photo" height="117px" width="118px"/>
                </dd>
            </dl>
            <dl class="dl02">
            	<dt>
                	<span>修改密码</span>
                </dt>
                <dd>
                	<div class="item"><span><font>*</font>原密码：</span><input type="text" class="txt" name="pwd"/></div>
                    <div class="item"><span><font>*</font>新密码：</span><input type="password" class="txt" name="pwd1"/></div>
                    <div class="item"><span><font>*</font>确认密码：</span><input type="password" class="txt" name="pwd2"/></div>
                    <div class="item"><input type="button" class="buto" value="确认修改" @click="fun()"/></div>
                </dd>
            </dl>
        </div>
        <div class="clear"></div>
    </div>
</div>
</div>
<!--footer-->
<div class="footer">
	<div class="f_bz">
    	<div class="w1200">
            <dl class="dl01">
                <dt>正品保证</dt>
                <dd>正品护航  购物无忧</dd>
            </dl>
            <dl class="dl02">
                <dt>你消费 我买单</dt>
                <dd>返现购物商城</dd>
            </dl>
            <dl class="dl03">
                <dt>品类丰富</dt>
                <dd>品类齐全 轻松购物</dd>
            </dl>
            <dl class="dl04">
                <dt>特色服务体验</dt>
                <dd>为您呈现不一样的服务</dd>
            </dl>
            <div class="clear"></div>
        </div>
    </div>
	<div class="f_nav">
    	<div class="w1200">
            <dl>
                <dt>新手指南</dt>
                <dd>
                    <a href="#">注册新用户</a>
                    <a href="#">商品订购流程</a>
                    <a href="#">会员注册协议</a>
                </dd>
            </dl>
            <dl>
                <dt>付款方式</dt>
                <dd>
                    <a href="#">支付宝支付</a>
                    <a href="#">网上银行支付</a>
                    <a href="#">货到付款</a>
                </dd>
            </dl>
            <dl>
                <dt>常见问题</dt>
                <dd>
                    <a href="#">订单状态</a>
                    <a href="#">发票说明</a>
                </dd>
            </dl>
            <dl>
                <dt>售后服务</dt>
                <dd>
                    <a href="#">退换货政策</a>
                    <a href="#">退换货流程</a>
                    <a href="#">退款说明</a>
                    <a href="#">退换货申请</a>
                </dd>
            </dl>
            <dl>
                <dt>客服中心</dt>
                <dd>
                    <a href="#">常见问题</a>
                    <a href="#">联系客服</a>
                    <a href="#">投诉与建议</a>
                </dd>
            </dl>
            <div class="ewm"><img src="images/home/ico35.png"/></div>
            <div class="ewm"><img src="images/home/ico38.png"/></div>
            <div class="clear"></div>
        </div>
    </div>
    <div class="w1200">
        <div class="bottom">
            <a href="#">关于我们</a>|<a href="#">帮助中心</a>|<a href="#">法律声明</a>|<a href="#">用户协议</a>|<a href="#">联系我们</a>|<a href="#">人才招聘</a>|<a href="#">站点地图</a>
           
            <p>网络文化经营许可证：粤网文[2015]0295-065号<br />© 2015 深圳易易城科技网络有限公司. 粤ICP备15042543号</p>
            <p class="p02"><img src="images/home/ico25.jpg"/><img src="images/home/ico26.jpg"/><img src="images/home/ico27.jpg"/><img src="images/home/ico36.jpg"/><img src="images/home/ico37.jpg"/></p>
        </div>
    </div>
</div>
<!--float_right-->
<div class="float">
	<ul>
    	<li><a href="#" class="a01"></a></li>
        <li><a href="#" class="a02"></a></li>
        <li><a href="#" class="a03"></a></li>
        <li><a href="#" class="a04"></a></li>
    </ul>
</div>
<script type="text/javascript" src="js/ajaxfileupload.js"></script>
<script type="text/javascript" src="js/vue.min.js"></script>
<script type="text/javascript" src="js/axios.min.js"></script>
<script type="text/javascript" src="js/md5.js">< /script>
<script type="text/javascript" src="js/qs.js"></script>
<script type="text/javascript">
let yc_login=new Vue({
	el:"#yc_login",//对应div的id,即这个vue的作用域
	data:{
		onlogin:false,
		outlogin:true,
		user:{},
		carts:[],
		goodsCount:0
	},
	mounted:function(){//数据挂载之前，相当于jquery中的$(function(){}),页面加载完成
		axios({
			url:'member.action?op=check',
			method:'get'
		}).then(result=>{
			if(result.data.member){//说明登录了
				this.onlogin=true;
				this.outlogin=false;
				this.user=result.data.member;
			
				if(result.data.carts){
					this.carts=result.data.carts;
					this.goodsCount=result.data.carts.length;
				}
			}else{
				this.onlogin=false;
				this.outlogin=true;
				alert('请先登录。。。');
				location.href='login.html';
			}
		});
	},
	methods:{
		fun:function(){
			var value=$('.item input[name="pwd"]').val();
			var pwd = hex_md5(value);
			var mno=this.user.mno;
			if(this.user.pwd!=pwd){
				alert("与原密码不一致！")
				return ;
			}
			var pwd1=$('.item input[name="pwd1"]').val();
			var pwd2=$('.item input[name="pwd2"]').val();
			if(pwd==null||pwd==""||pwd1==null||pwd1==""||pwd2==null||pwd2==""){
				alert('密码不能为空');
				return ;
			}
			if(pwd1!=pwd2){
				alert('密码不一致');
				return ;
			}
			axios({
				url:'member.action',
				method:'post',
				params:{op:"update",mno:mno,pwd:pwd1}
			}).then(result=>{
				//如果订单生成成功，返回订单编号
				let data=result.data;
				if(data>0){
					this.out();
					location.href='login.html';
				}else{
					alert('密码格式有误')
					return ;
				}
			});
		},
		goHead:function(){
			$.ajaxFileUpload({
				url:'memberFileUpload.action',
				secureuri:false,
				fileElementId:'pics',
				dataType:'json',
				data:{
					mno:this.user.mno
				},
				success:function(data){
					if(data>0){
						alert("修改成功");
						location.href='pwd.html';
					}
				}
			});
		},
		out:function(){
			axios({url:'member.action?op=out',method:'get'})
			.then(result=>{
				let data=result.data;
				if(data==1){
					location.href='login.html';
				}else{
					alert('退出失败！！');
					return ;
				}
			});
		}
	}
});

</script>
</body>
</html>
